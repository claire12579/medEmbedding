# 🏥 医学文档智能检索系统

基于BGE-M3语义检索技术的医学文档智能检索系统，可以帮助医生快速在标准文档中定位相关诊疗信息。

## 📋 功能特性

- **语义检索**: 使用BGE-M3模型进行语义理解，而非简单的关键词匹配
- **智能分段**: 自动将医学文档分割为合适的文本片段
- **高效索引**: 基于FAISS的向量索引，快速检索相关内容
- **高亮显示**: 自动高亮查询相关的文本内容
- **简洁界面**: 专为医务人员设计的简洁直观界面

## 🚀 快速开始

### 1. 环境准备

确保已安装Python 3.8+和conda：

```bash
# 创建conda环境
conda create -n embedding python=3.12 -y

# 激活环境
conda activate embedding

# 安装依赖包
pip install sentence-transformers faiss-cpu PyPDF2 flask flask-cors numpy pandas
```

### 2. 运行系统

```bash
# 激活conda环境
conda activate embedding

# 运行系统
python run_medical_search.py
```

首次运行时系统会：
1. 自动下载BGE-M3模型（约2GB）
2. 解析PDF文档
3. 生成文本嵌入向量
4. 构建检索索引
5. 启动Web服务

### 3. 访问系统

打开浏览器访问：`http://localhost:5001`

## 📖 使用说明

### 支持的查询类型

- **症状描述**: "结节5mm"、"肺部阴影"
- **诊断相关**: "诊断标准"、"鉴别诊断"  
- **治疗方案**: "治疗方案"、"用药指导"
- **检查项目**: "影像学表现"、"病理分型"

### 使用技巧

1. **精确查询**: 输入具体的医学术语获得更准确的结果
2. **组合查询**: 可以输入多个关键词，如"肺结节 5mm 诊断"
3. **中文查询**: 系统完全支持中文医学术语
4. **结果排序**: 检索结果按相似度从高到低排列

## 🏗️ 系统架构

```
├── medical_search.py          # 主程序文件
├── run_medical_search.py      # 启动脚本
├── templates/
│   └── index.html            # 前端界面
├── index/                    # 索引文件目录（自动生成）
│   ├── document.index        # FAISS索引文件
│   ├── chunks.pkl           # 文档片段数据
│   └── embeddings.npy       # 嵌入向量数据
└── *.pdf                    # PDF医学文档
```

## ⚙️ 核心技术

- **BGE-M3**: 中文语义理解模型，支持多语言和长文本
- **FAISS**: Facebook开源的向量检索库，高效相似度搜索
- **PyPDF2**: PDF文档解析和文本提取
- **Flask**: 轻量级Web框架，提供API接口
- **语义分段**: 智能文本分割，保持语义完整性

## 🔧 配置选项

可以在`medical_search.py`中调整以下参数：

```python
# 文本分割参数
chunk_size = 500      # 每个文本块的最大字符数
overlap = 50          # 文本块之间的重叠字符数

# 检索参数  
top_k = 5            # 返回的最相关结果数量

# 模型参数
model_name = "BAAI/bge-m3"  # 使用的embedding模型
```

## 📊 性能说明

- **首次启动**: 需要下载模型和构建索引，约5-10分钟
- **后续启动**: 加载已有索引，约30秒
- **检索速度**: 单次查询响应时间 < 1秒
- **支持文档**: 建议单个PDF文档 < 100MB

## ❓ 常见问题

### Q: 首次运行很慢？
A: 系统需要下载BGE-M3模型（约2GB），请确保网络连接正常。

### Q: PDF无法解析？
A: 请确保PDF文件不是扫描版，系统需要可提取的文本内容。

### Q: 检索结果不准确？
A: 尝试使用更具体的医学术语，或者调整chunk_size参数。

### Q: 系统占用内存大？
A: BGE-M3模型需要约4GB内存，建议在8GB以上内存的机器上运行。

## 📝 更新日志

### v1.0.0
- 基础语义检索功能
- BGE-M3模型集成
- FAISS索引构建
- Web界面实现
- 文本高亮显示

## 🤝 贡献

欢迎提交Issue和Pull Request来改进系统功能。

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。 